<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head>
    <title data-n-head="true">笔记：velocity 2016 第一天 | 文蔺的博客</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta data-n-head="true" name="description" content="文蔺的前端学习记录，国外技术文章翻译，个人学习心得等等这些都会记录在这里。"><meta data-n-head="true" name="keywords" content="原创,笔记"><meta data-n-head="true" name="description" content="velocity 2016 笔记"><link data-n-head="true" rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/static/0501d49c081ea86e209e.css">
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="wrapper"><nav id="sidebar" class="behavior_1"><div class="wrap"><div class="profile"><a href="/" class="nuxt-link-active"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a> <span>文蔺的博客</span></div> <ul class="buttons"><li><a href="/" title="主页" class="nuxt-link-active"><i class="iconfont icon-home"></i> <span> 主页</span></a></li><li><a href="/archives" title="归档"><i class="iconfont icon-archive"></i> <span> 归档</span></a></li><li><a href="/slides" title="Slides"><i class="iconfont icon-archive"></i> <span> Slides</span></a></li><li><a href="/about" title="关于"><i class="iconfont icon-user"></i> <span> 关于</span></a></li><li><a href="/link" title="关注"><i class="iconfont icon-link"></i> <span> 关注</span></a></li><li><a href="/collection" title="收藏"><i class="iconfont icon-archive"></i> <span> 收藏</span></a></li></ul></div> <ul class="buttons"><li><a href="https://github.com/AngusFu/" rel="nofollow" target="_blank" class="inline"><i title="GitHub" class="iconfont icon-github-v"></i></a> <!----> <!----> <a href="/atom.xml" target="_blank" class="inline"><i title="RSS" class="iconfont icon-rss-v"></i></a> <a href="/search" class="inline"><i title="Search" class="iconfont icon-search"></i></a></li></ul></nav> <div id="header"><div class="btn-bar"><i></i></div> <h1><a href="/" class="nuxt-link-active">文蔺的博客</a></h1> <a href="/about/" class="me"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a></div> <div id="sidebar-mask" style="display:none"></div> <div id="main" class="main"><div id="page-post"><article class="post detail"><div class="meta"><div class="date">2016-12-01</div></div> <h1 class="title">笔记：velocity 2016 第一天</h1> <div class="entry-content"><!----> <p>有幸得到老大给的 Velocity 大会门票，屁颠屁颠跑去听分享。下面是今天（第一天）的笔记。记得比较简略，凑合看吧。<a href="http://velocity.oreilly.com.cn/2016/index.php?func=slidesvideos" target="_blank">PPT 下载通道</a>已经放出来了，感兴趣的可以自己跟踪一下。</p> <h2 id="usetheplatform-web-">UseThePlatform —— Web 组件介绍</h2> <blockquote><p>分析者：来自 Youtube 的 Mikhail Sychev</p> <p>感觉就是对 Polymer 和 Web Components 的科普。期待明天更详细的分享。</p> <p>其实关于 Polymer，打开 Chrome 的 <code>chrome://downloads/</code> 查看源码，就能学到不少东西：CSS 变量、Shadow DOM、Polymer 等等。之前打算就这个写篇博客，一直没动手。</p></blockquote> <p>(略….)</p> <hr> <h2 id="-">搜索引擎性能优化的未来 —— 搜索极速浏览框架</h2> <blockquote><p>分享者：来自百度的陶清乾</p> <p>听到最后才发现，原来是搞了套自己的后端工具，你“打开”的页面，可能只是百度缓存、处理过的。（免责声明：理解可能有偏差）还提了下使用的 工具 MIP。</p></blockquote> <h3 id="-">全流程优化</h3> <ul><li>展现交互</li> <li>加载策略</li> <li>页面渲染</li></ul> <h3 id="-">框架解决问题</h3> <ul><li>创建容器视图，提升交互体验</li> <li>异步加载渲染，提升页面渲染速度</li> <li>prefetch 实例，优化网络、服务开销</li> <li>优化机制，优化细粒度模块速度</li></ul> <h3 id="-">感知交互时间</h3> <p>点击搜索结果 => 页面响应</p> <h3 id="-">加速原理</h3> <h4 id="-">传统页面</h4> <p>点击。连接。响应。基础渲染。内容渲染。组件加载。</p> <h4 id="-">加速</h4> <p>点击 </p> <p>​    A => 交互响应。基础渲染。。。。</p> <p>​        B => 连接。响应。 。。。</p> <p>。。。。内容渲染、组件加载</p> <h2 id="-">应用性能数据可视化</h2> <blockquote><p>分享者：来自 mmTrix 的朱建锋</p> <p>先是对可视化、性能等做了一些介绍，之后讲数据处理，科普了几种平均数，之后科普了各种常用的图（如雷达图、南丁格尔玫瑰图 etc.）。</p></blockquote> <h3 id="-">前面</h3> <ul><li>尽量使用抗干扰性更好的方法计算性能数据</li> <li>标准差衡量性能标准</li></ul> <h3 id="-">可视化是一个编码过程</h3> <ul><li>基本的简单的图。</li> <li>目的：表达数据。</li></ul> <h3 id="-1s">请求理想时间小于 1s</h3> <ul><li>DNS: 50ms</li> <li>TCP shakes: 100ms</li> <li>SSL(https): 300ms</li> <li>Waiting for Response: 250ms（网络请求 => First Byte）</li> <li>接收 Data: 300ms</li></ul> <hr> <h2 id="hulu-react-redux-">Hulu 的 React / Redux 构架实践</h2> <blockquote><p>分享者：来自“美国的爱奇艺” Hulu 的程墨</p> <p>较基础，但对于 Constraints vs Conventions 相关的内容非常不错，很值得思考。</p></blockquote> <h3 id="challenges">Challenges</h3> <ul><li>System Complexity<ul><li>Legacy code in jQuery & Backbone</li> <li>UI non-predictable</li> <li>Lack of component isolation</li></ul></li> <li>Performance Bottleneck<ul><li>Initial AJAX roundtrip</li></ul></li></ul> <h3 id="tech-stack">Tech Stack</h3> <ul><li><strong>Before</strong>: jQuery + Backbone + Ruby on Rails</li></ul> <ul><li><strong>After</strong>: React + Redux + Node & Express</li></ul> <h3 id="other-notes">Other Notes</h3> <ul><li><code>React APP = Keep Rndering</code></li> <li><code>UI = f(state)</code></li> <li>Constraints vs Conventions</li></ul> <hr> <h2 id="-react-native-">数亿级用户规模下的 React Native 应用实践</h2> <blockquote><p>分享者：来自百度的雷志兴</p> <p>做过一段时间的 RN，所以基本能听懂。</p> <p>其他的内容，个人感觉可算干货满满。没提到热更新。</p> <p>结合此前 58 同城 RN、携程 RN 等文章一起看，会更好的哈哈</p></blockquote> <h3 id="-">手机百度</h3> <ul><li>迭代周期： 4周</li> <li>主要 features：数十个</li> <li>开发工时：数千人时</li> <li>跨部门，沟通成本高</li> <li>业务种类多，集成成本高</li> <li>过去的解耦方案<ul><li>APK 插件 / SDK</li> <li>Hybrid</li></ul></li> <li>迭代速度：native 的 5-8 倍</li></ul> <h3 id="rn-">RN 工程实践</h3> <ul><li>与现有业务融合<ul><li>Android 4.1 以上</li> <li>v0.32 以上不支持 iOS 7</li> <li><strong>降级兼容</strong>：随时回撤；AB Test</li> <li><strong>性能方面</strong>: 空间换时间，便利性换性能；减少重绘，减少通讯</li> <li>统一交互协议：RN 和 Native 相互之间的调用</li></ul></li> <li>融入迭代流程<ul><li>首先，前提是业务方明确提出 RN 产品需求，明确哪些能够做到</li> <li>容灾方案：报错率较高怎么办？</li> <li>开发</li> <li>发布：打包、测试后由 PM 从平台发布</li> <li><strong>监控</strong>：一定要能够监控到 RN 层，尤其是 js 层的报错信息（Note：坑！！！！！！！！）</li></ul></li> <li>性能优化<ul><li>通讯频繁 by design： js 足够的灵活性</li> <li>易导致卡顿<ul><li>事件频率高</li> <li>js 运行时间长</li> <li>UI 绘制频繁</li></ul></li> <li>初始化成本高<ul><li>生成模块配置表</li></ul></li> <li>ListView 优化<ul><li>View 无法复用，内存紧张</li> <li>DOM diff： 大量重新渲染</li> <li>业务层优化：预留空白单元；大量内容时重新渲染</li> <li><strong>解决 1</strong>：删除非可视区 View</li> <li><strong>解决 2</strong>：模板复用（item 可能跳动、闪烁）</li> <li>建议：产品进行限制，超过一定数量时重新刷新</li></ul></li> <li>动画<ul><li>16ms，容易丢帧</li> <li>实验特性 userNativeDriver: true —— 将动画数据算好全部发给 Native，减少通讯</li></ul></li> <li>启动速度优化<ul><li>预初始化：APP 启动后，立即 instance Init，用户点击的时候，就可以直接开始 js 业务</li> <li>首页业务多，instance 初始化过多，开销太大。</li> <li>单 Instance 多业务：Component 方法加载业务，无法使用 global</li> <li>按需加载：公用部分在初始化时加载，业务部分在交互时才开始加载</li></ul></li> <li>延迟加载、渲染</li></ul></li> <li>跨端方案对比<ul><li>RN 适用场景<ul><li>超级 APP</li> <li>体验平台级 APP</li></ul></li> <li>Hybrid：...</li> <li>APK 插件：...</li></ul></li> <li>Summary<ul><li>发版周期、开发成本和使用体验之间找到平衡</li> <li>系统性工程：有机融入 APP</li> <li>...</li></ul></li></ul> <h3 id="q-a">Q&A</h3> <ul><li>h5 和 RN 迭代的问题：两端齐头并进，各自开发</li> <li>Native Module 问题上报：....</li> <li>非结构化 ListView 优化：RN 做的话，很难解决，结构样式尽量简单一些</li> <li>RN 版本升级应对：RN 的 持续交付。。。</li></ul> <hr> <h2 id="-weex-">双十一 Weex 会场极致性能优化</h2> <blockquote><p>分享者：阿里的冯成晓、周婷婷</p> <p>终于面对面接触到 Weex 分享了。很久之前逢阿里面试官必问 Weex，想必他们烦极了。</p> <p>和百度同学关于 RN 的分享两场一起听下来，真的收获多多。</p> <p>印象非常好的一点是，分享过程中，反复提到 W3C 标准，提到希望补齐和 W3C 性能优化相关的 feature。这种思路应该是非常棒的。</p></blockquote> <ul><li><code>f(HTML/CSS/JS) = Native UI</code></li> <li>DSL(HTML/CSS/JS) -> Virtual DOM -> Renderer -> UI</li> <li>Transformer: DSL -> JS Bundle</li> <li>JSFramework: DOM Tree<ul><li>模板编译，数据绑定</li></ul></li> <li>Render：参照 Webkit<ul><li>Build Tree</li> <li>Compute Style</li> <li>CSS Layout  (… Reflow, Relayout)</li> <li>Create View</li> <li>Update Frame</li> <li>Set View Props (… RePaint)</li> <li>Native View</li></ul></li></ul> <h3 id="-">优化</h3> <ul><li>下载 js： 预加载</li> <li>执行 js：单 context 共享</li> <li>解析 DOM： Node & Tree 解析结合</li> <li>渲染 UI： List & 异步渲染（内存复用，只会渲染可见部分）</li> <li>全局污染治理 + JSCore 内存管理</li></ul> <h3 id="-">性能优化指标</h3> <ul><li>秒开率：加载时间+首屏时间 &lt; 1s<ul><li>加载时间：js bundle 加载时间</li> <li>...</li></ul></li> <li>Weex 会场页面数：1700+，占比 99.6%</li> <li>主会场 FPS：低端机 53， 高端机58</li> <li>动画、视频、直播、全景图都是 Weex</li></ul> <h3 id="-">实战部分</h3> <ul><li>列表过长，WebView 内存不好控制，容易 crash </li> <li>加载 js bundle：本地 IO 最快<ul><li>APP 启动，预先下载 js</li> <li>长连接通道 Push</li> <li>全量/增量，被动/强制更新结合</li></ul></li> <li>预加载使用策略<ul><li>根据业务特性斟酌</li> <li>1700 个页面，由相同模板自由组合变成的</li> <li>模块化，小粒度缓存</li> <li>原来：1600 * 55 = 93 M</li> <li>模块 + 配置：1700 <em> 5 + 30 </em> 10 = 8.8 M</li> <li>但是模块 +配置这样的秒开率低了 10%</li> <li>业务个性化预加载，根据进入场景下载：类似 <link preload=""></li> <li>preload & prerender：<ul><li>dns-prefetch</li> <li>preconnect（DNS + TCP connect）</li> <li>prefetch</li> <li>subresources（depreciated）</li> <li>preload</li> <li>prerender</li></ul></li></ul></li> <li>js 执行<ul><li>安卓下 V8 解析 js 耗时</li> <li>减少 bundle size：去重，分离，通用组件内置</li> <li>减少 VDOM 更新<ul><li>shouldComponentUpdate</li> <li>pureRenderMixin</li></ul></li></ul></li> <li>动态数据并行预加载<ul><li>点击时直接请求，然后存储在 storage 中（文蔺注：这块儿好像可以参考手机 QQ 家校 or 兴趣部落 React 的优化的文章）</li> <li>storage LRU 策略</li> <li>首屏数据请求参数不固定？。。。</li> <li>jsbundle 走本地，效果如何？。。。</li> <li>优化效果 80% 以上</li></ul></li> <li>首屏 UI 渲染<ul><li>使用 list 代替 scroller</li> <li>尽量减少布局嵌套</li> <li>首屏以外的模板延迟初始化</li> <li>新方案：requestIdleCallback</li></ul></li> <li>最佳实践<ul><li>尽量 prefetch</li> <li>use list</li> <li>cell 细粒度拆分</li> <li>减少首次加载内容</li> <li>减少 js 大小</li></ul></li> <li>工具<ul><li>Xcode simulator</li> <li>Safari 10 Remote Inspector</li></ul></li> <li>性能指标优化流程（图）<ul><li>发布基线</li> <li>预发检测</li> <li>线上监控</li> <li>生成报表 &lt;=== 业务达标基线</li> <li>问题分析</li> <li>开发修复</li> <li>预发检测</li> <li>。。。。</li></ul></li> <li>Week 下一阶段<ul><li>W3C 性能优化 feature 补齐</li> <li>性能 profile</li> <li>完整开发模式</li> <li>更丰富的交互体验</li> <li>更丰富的 module 和 component</li></ul></li></ul></div></article> <nav class="pagination"><a href="/post/velocity-2016-day-2" title="笔记：velocity 2016 第二天" class="prev">« 笔记：velocity 2016 第二天</a> <a href="/post/when-to-use-which-css-methodology" title="[译] CSS 方法论的选择" class="next">[译] CSS 方法论的选择 »</a></nav></div> <footer id="footer" class="inner">
      © 2022 -  文蔺的博客
      
        <span> - </span> <a href="/" class="nuxt-link-active">www.wemlion.com</a> <br>
      Powered by <a target="_blank" href="https://nuxtjs.org">Nuxt.js</a> & <a target="_blank" rel="nofollow" href="https://firekylin.org" class="external">FireKylin</a></footer></div></div></div></div><script>window.__NUXT__={layout:"default",data:[{}],error:null,serverRendered:!0}</script><script src="/static/c418fb652629ac1ad5ca.js" defer></script><script src="/static/9e1e5c4a2c15b1eb5f44.js" defer></script><script src="/static/a04af2434d342797c405.js" defer></script><script src="/static/a9e13b4b84fcd888d410.js" defer></script><script src="/static/0329710550037b626a84.js" defer></script>
  </body>
</html>
