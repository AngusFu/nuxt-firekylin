(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{173:function(t,l,n){"use strict";n.r(l);var v={computed:{data:function(){return{title:"[译] 渐进增强的键盘导航",description:"better-keyboard-navigation-with-progressive-enhancement/",keywords:"翻译,用户体验,可用性",pathname:"better-keyboard-navigation-with-progressive-enhancement",translation:{author:"@codepo8",social:"https://twitter.com/codepo8",from:"https://www.christianheilmann.com/2016/08/15/better-keyboard-navigation-with-progressive-enhancement/"},create_time:"2016-08-30",prev:{title:"聊聊 JavaScript Date 对象",pathname:"date-in-javascript"},next:{title:"[译] Fetch 请求的本地缓存",pathname:"cache-fetched-ajax-requests"}}}}},e=n(3),component=Object(e.a)(v,function(){var t=this,l=t.$createElement,n=t._self._c||l;return n("post",{attrs:{data:t.data}},[n("p",[t._v("创建界面时很重要的一点是，要考虑到那些只依赖键盘来使用产品的用户。这对可访问性来说是基本要求，在多数情况下，通过键盘操作访问也并非难事。这意味着首先，也是最重要的，是使用键盘可访问元素进行交互。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("如果希望用户跳转到其他地方，使用带有有效的 href 属性的锚点连接")])]),t._v(" "),n("li",[n("p",[t._v("如果希望用户执行你自己的代码，并在当前文档中停留，使用按钮")])])]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t01adc9f3ae9a586201.jpg",expression:"`https://p.ssl.qhimg.com/t01adc9f3ae9a586201.jpg`"}],attrs:{alt:"键盘"}})]),t._v(" "),n("p",[t._v("通过"),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/Accessibility/Keyboard-navigable_JavaScript_widgets",target:"_blank"}},[t._v("流动 tabIndex 技术")]),t._v("几乎可以使所有内容都能通过键盘访问，不过，既然已经有 HTML 元素可以做同样的事情，又何必再麻烦呢。")]),t._v(" "),n("h2",{attrs:{id:"-"}},[t._v("效果可视化")]),t._v(" "),n("p",[t._v("不过，使用恰当的元素并不那么简单；用户键盘在元素集合中所处的位置，也要显眼一些。给激活的元素加上轮廓（outline），浏览器解决了这个问题。这虽然超有用，但却是一些人的眼中钉，他们希望由自己控制所有交互的视觉展现。在 CSS 中将 outline 属性设置为 none，就能移除这个视觉辅助功能；不过这会带来"),n("a",{attrs:{href:"http://www.outlinenone.com/",target:"_blank"}},[t._v("不小的可访问性问题")]),t._v("，除非你提供一个别的替代。")]),t._v(" "),n("p",[t._v("使用最显眼的 HTML 元素；加上一些 CSS，确保除 hover 之外 focus 状态同样也被定义。这样就可以使用户在列表中的一个个项目间，轻松地通过 tab 来切换了。Shift + Tab 允许回退。可以看下 "),n("a",{attrs:{href:"http://jsbin.com/ronuzis",target:"_blank"}},[t._v("demo")]),t._v("，HTML 挺简单粗暴的。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-html"},[n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("ul")]),t._v(">")]),t._v("\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),t._v("1"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),t._v("2"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),t._v("3"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n  …\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),t._v("20"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("button")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("ul")]),t._v(">")])])]),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t01f5cf80c24e3e5365.gif",expression:"`https://p.ssl.qhimg.com/t01f5cf80c24e3e5365.gif`"}],attrs:{alt:"在按钮列表中 tab 切换"}})]),t._v(" "),n("p",[t._v("使用列表，为我们的元素赋予了层次结构，以及普通浏览器所没有的可访问性技术的导航方式。它还带来很多 HTML 元素，我们可以自己添加样式。通过一点样式，我们可以将其转换为网格，占用更少的垂直空间，容纳更多内容。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-css"},[n("span",{staticClass:"hljs-selector-tag"},[t._v("ul")]),t._v(", "),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("margin")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("0")]),t._v(";\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("padding")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("0")]),t._v(";\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("list-style")]),t._v(": none;\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("button")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("border")]),t._v(": none;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("display")]),t._v(": block;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("background")]),t._v(": goldenrod;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("color")]),t._v(": white;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("90%")]),t._v(";\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("height")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("30px")]),t._v(";  \n  "),n("span",{staticClass:"hljs-attribute"},[t._v("margin")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("5%")]),t._v(";\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("transform")]),t._v(": "),n("span",{staticClass:"hljs-built_in"},[t._v("scale")]),t._v("(0.8);\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("transition")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("300ms")]),t._v(";\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("button")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":hover")]),t._v(", "),n("span",{staticClass:"hljs-selector-tag"},[t._v("button")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":focus")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("transform")]),t._v(": "),n("span",{staticClass:"hljs-built_in"},[t._v("scale")]),t._v("(1);\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("outline")]),t._v(": none;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("background")]),t._v(": powderblue;\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("color")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("#333")]),t._v(";\n}\n\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("float")]),t._v(": left;\n}\n\n"),n("span",{staticClass:"hljs-comment"},[t._v("/* \n  grid magic by @heydonworks \n  https://codepen.io/heydon/pen/bcdrl\n*/")]),t._v("\n\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-built_in"},[t._v("calc")]),t._v("(100% / 4);\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(1)")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("100%")]),t._v(";\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(1)")]),t._v(" ~ "),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("100%")]),t._v(";\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(2)")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("50%")]),t._v(";\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(2)")]),t._v(" ~ "),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("50%")]),t._v(";\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(3)")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-built_in"},[t._v("calc")]),t._v("(100% / 4);\n}\n"),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-child(4n+1)")]),n("span",{staticClass:"hljs-selector-pseudo"},[t._v(":nth-last-child(3)")]),t._v(" ~ "),n("span",{staticClass:"hljs-selector-tag"},[t._v("li")]),t._v(" {\n  "),n("span",{staticClass:"hljs-attribute"},[t._v("width")]),t._v(": "),n("span",{staticClass:"hljs-built_in"},[t._v("calc")]),t._v("(100% / 4);\n}")])]),n("p",[t._v("结果"),n("a",{attrs:{href:"http://output.jsbin.com/cujomeq/",target:"_blank"}},[t._v("看起来非常棒")]),t._v("，在查看列表的过程中，我们能清楚地看到自己所处的位置。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t0192466c1b3d4a0744.gif",expression:"`https://p.ssl.qhimg.com/t0192466c1b3d4a0744.gif`"}],attrs:{alt:"网格中一格格地切换"}})]),t._v(" "),n("h2",{attrs:{id:"-"}},[t._v("键盘访问的升级 —— 提供快捷方式")]),t._v(" "),n("p",[t._v("不过，在访问网格时，通过键盘进行两个方向的移动会不会更好呢？")]),t._v(" "),n("p",[t._v("使用一点 JavaScript 做渐进增强，"),n("a",{attrs:{href:"http://jsbin.com/mafeko/",target:"_blank"}},[t._v("我们做到了")]),t._v("，可以使用鼠标或方向键访问网格。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t0108c1e3e1785dfe95.gif",expression:"`https://p.ssl.qhimg.com/t0108c1e3e1785dfe95.gif`"}],attrs:{alt:"使用鼠标控制方向切换网格访问"}})]),t._v(" "),n("p",[t._v("不过记着，这仅仅只是一个"),n("strong",[t._v("增强")]),t._v("。假设 JavaScript 因为各种可能的原因执行失败，依然可以通过 tab 来访问列表，我们失去的只是便利，但至少还有可用的界面。")]),t._v(" "),n("p",[t._v("我将这个打包成了一个小巧、无依赖的开源 JavaScript 项目 "),n("a",{attrs:{href:"https://github.com/codepo8/gridnav",target:"_blank"}},[t._v("gridnav")]),t._v("，可以在 "),n("a",{attrs:{href:"https://codepo8.github.io/gridnav",target:"_blank"}},[t._v("GitHub")]),t._v(" 上获取代码。你要做的就是调用脚本，传给它一个选择器以获取元素列表。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-html"},[n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("ul")]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("id")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"links"')]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("data-amount")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"5"')]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("data-element")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"a"')]),t._v(">")]),t._v("\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("href")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"#"')]),t._v(">")]),t._v("1"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("href")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"#"')]),t._v(">")]),t._v("2"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n  …\n  "),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("href")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"#"')]),t._v(">")]),t._v("25"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("a")]),t._v(">")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("li")]),t._v(">")]),t._v("\n"),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("ul")]),t._v(">")]),t._v("\n\n"),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(" "),n("span",{staticClass:"hljs-attr"},[t._v("src")]),t._v("="),n("span",{staticClass:"hljs-string"},[t._v('"gridnav.js"')]),t._v(">")]),n("span",{staticClass:"undefined"}),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(">")]),t._v("\n"),n("span",{staticClass:"hljs-tag"},[t._v("<"),n("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(">")]),n("span",{staticClass:"actionscript"},[t._v("\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" linklist = "),n("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Gridnav("),n("span",{staticClass:"hljs-string"},[t._v("'#links'")]),t._v(");\n")]),n("span",{staticClass:"hljs-tag"},[t._v("</"),n("span",{staticClass:"hljs-name"},[t._v("script")]),t._v(">")])])]),n("p",[t._v("通过列表元素的 data- 属性，可以自己定义每行元素的数量以及键盘可访问的元素。这些是可选的，但设置之后会让代码更快，出错可能性更小。"),n("a",{attrs:{href:"https://github.com/codepo8/gridnav/blob/master/README.md",target:"_blank"}},[t._v("README")]),t._v(" 文件更详细地解释了如何使用。")]),t._v(" "),n("h2",{attrs:{id:"-"}},[t._v("工作原理")]),t._v(" "),n("p",[t._v("开始考虑如何做的时候，像任何开发者一样，抓到了最复杂的方式。我以为，需要对父节点、兄弟节点的大量定位比较，使用上 "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect",target:"_blank"}},[t._v("getBoundingClientRect")]),t._v("，进行大量的 DOM 访问。")]),t._v(" "),n("p",[t._v("之后我往回走了一步，意识到如何展示列表并不重要。最终不过是一个列表，我们要访问它而已。甚至不需要访问 DOM，因为我们所做的不过是从一堆按钮或锚点连接中的一个切换到另一个。我们要做的就是：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("找到当前所在元素（"),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Event/target",target:"_blank"}},[t._v("event.target")]),t._v("）。")])]),t._v(" "),n("li",[n("p",[t._v("获取按下的键。")])]),t._v(" "),n("li",[n("p",[t._v("根据键向前向后移动，或跳过一些元素到下一行。")])])]),t._v(" "),n("p",[t._v("就像这样（"),n("a",{attrs:{href:"https://codepo8.github.io/gridnav/tutorialfiles/demo-to-inline.html",target:"_blank"}},[t._v("点击这里试试看")]),t._v("）：")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t01fd0f3a12ee84c71c.gif",expression:"`https://p.ssl.qhimg.com/t01fd0f3a12ee84c71c.gif`"}],attrs:{alt:"网格中移动和在坐标系中移动一样"}})]),t._v(" "),n("p",[t._v("我们需要跳过的元素数量是由每行的元素数量决定的。向上等同于向前 n 个元素，向下相当于向后 n 个元素。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t017ff0dbc0bb99bb24.png",expression:"`https://p.ssl.qhimg.com/t017ff0dbc0bb99bb24.png`"}],attrs:{alt:"网格移动图解"}})]),t._v(" "),n("p",[t._v("使用一些小技巧，完整代码非常简短：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("("),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v("("),n("span",{staticClass:"hljs-params"}),t._v(")")]),t._v("{\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" list = "),n("span",{staticClass:"hljs-built_in"},[t._v("document")]),t._v(".querySelector("),n("span",{staticClass:"hljs-string"},[t._v("'ul'")]),t._v(");\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" items = list.querySelectorAll("),n("span",{staticClass:"hljs-string"},[t._v("'button'")]),t._v(");\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" amount = "),n("span",{staticClass:"hljs-built_in"},[t._v("Math")]),t._v(".floor(\n    list.offsetWidth / list.firstElementChild.offsetWidth\n  );\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" codes = {\n    "),n("span",{staticClass:"hljs-number"},[t._v("38")]),t._v(": -amount,\n    "),n("span",{staticClass:"hljs-number"},[t._v("40")]),t._v(": amount,\n    "),n("span",{staticClass:"hljs-number"},[t._v("39")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("1")]),t._v(",\n    "),n("span",{staticClass:"hljs-number"},[t._v("37")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("-1")]),t._v("\n  };\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("for")]),t._v(" ("),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" i = "),n("span",{staticClass:"hljs-number"},[t._v("0")]),t._v("; i < items.length; i++) {\n    items[i].index = i;\n  }\n  "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" "),n("span",{staticClass:"hljs-title"},[t._v("handlekeys")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("ev")]),t._v(") ")]),t._v("{\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" keycode = ev.keyCode;\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (codes[keycode]) {\n      "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" t = ev.target;\n      "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (t.index !== "),n("span",{staticClass:"hljs-literal"},[t._v("undefined")]),t._v(") {\n        "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (items[t.index + codes[keycode]]) {\n          items[t.index + codes[keycode]].focus();\n        }\n      }\n    }\n  }\n  list.addEventListener("),n("span",{staticClass:"hljs-string"},[t._v("'keyup'")]),t._v(", handlekeys);\n})();")])]),n("p",[t._v("这里发生了什么？")]),t._v(" "),n("p",[t._v("首先我们获取到了列表元素，并缓存所有可通过键盘访问的元素：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" list = "),n("span",{staticClass:"hljs-built_in"},[t._v("document")]),t._v(".querySelector("),n("span",{staticClass:"hljs-string"},[t._v("'ul'")]),t._v(");\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" items = list.querySelectorAll("),n("span",{staticClass:"hljs-string"},[t._v("'button'")]),t._v(");")])]),n("p",[t._v("计算每次上下移动需要跳过的元素数量，将列表的宽度除以列表第一个子元素（本例中是 LI）的宽度即可：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" amount = "),n("span",{staticClass:"hljs-built_in"},[t._v("Math")]),t._v(".floor(\n    list.offsetWidth / list.firstElementChild.offsetWidth\n  );")])]),n("p",[t._v("相较于 switch 语句或者大量的 if 判断，我更乐意使用查找表。在本例总共，查找表名字是 codes。向上键值为 38，向下 40，向左 37，向右 39。假如我们拿到了 codes[37]，值为 -1，也就是我们要在列表中移动的数量：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" codes = {\n    "),n("span",{staticClass:"hljs-number"},[t._v("38")]),t._v(": -amount,\n    "),n("span",{staticClass:"hljs-number"},[t._v("40")]),t._v(": amount,\n    "),n("span",{staticClass:"hljs-number"},[t._v("39")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("1")]),t._v(",\n    "),n("span",{staticClass:"hljs-number"},[t._v("37")]),t._v(": "),n("span",{staticClass:"hljs-number"},[t._v("-1")]),t._v("\n  };")])]),n("p",[t._v("可以使用 event.target 获取按下键盘时列表中的选中元素，但我们不知道它在列表中的位置。为避免重复遍历列表，一次性遍历所有按钮，将它们在列表中的索引存储在按钮自身的 index 属性中。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  "),n("span",{staticClass:"hljs-keyword"},[t._v("for")]),t._v(" ("),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" i = "),n("span",{staticClass:"hljs-number"},[t._v("0")]),t._v("; i < items.length; i++) {\n    items[i].index = i;\n  }")])]),n("p",[t._v("handlekeys() 完成剩余工作。读取所按按键的键值，然后到 codes 中查找。所以，我们只针对方向键做出响应。接着获取当前的元素，检查其是否有 index 属性。如果有，则检查我们将要移到的位置是否有元素存在。如果元素存在，则获得焦点。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" "),n("span",{staticClass:"hljs-title"},[t._v("handlekeys")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("ev")]),t._v(") ")]),t._v("{\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" keycode = ev.keyCode;\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (codes[keycode]) {\n      "),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" t = ev.target;\n      "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (t.index !== "),n("span",{staticClass:"hljs-literal"},[t._v("undefined")]),t._v(") {\n        "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (items[t.index + codes[keycode]]) {\n          items[t.index + codes[keycode]].focus();\n        }\n      }\n    }\n  }")])]),n("p",[t._v("给列表绑定一个 keyup 事件监听器，搞定 :)")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[t._v("  list.addEventListener("),n("span",{staticClass:"hljs-string"},[t._v("'keyup'")]),t._v(", handlekeys);")])]),n("p",[t._v("如果你想看真实效果，这有一个"),n("a",{attrs:{href:"https://www.youtube.com/watch?v=zc420bXDqWk",target:"_blank"}},[t._v("讲述各个细节的快速视频教程")]),t._v("。")]),t._v(" "),n("p",[t._v("视频在最后的代码部分有点 bug，因为我没将 count 属性和 undefined 对比，所以在第一个元素上，键盘功能没法正常工作（0 是 falsy）。")])])},[],!1,null,null,null);l.default=component.exports}}]);