(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{214:function(e,t,n){"use strict";n.r(t);var l={computed:{data:function(){return{title:"关于 setImmediate",description:"关于 setImmediate",keywords:"原创,JavaScript",pathname:"js-set-immediate",translation:null,create_time:"2016-10-27",prev:{title:"2016 年 10 月 27 日阅读笔记",pathname:"20161027-reading"},next:{title:"关于前端常见算法面试题的一些思考",pathname:"front-end-interview-algo-questions"}}}}},o=n(3),component=Object(o.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("post",{attrs:{data:e.data}},[n("h2",{attrs:{id:"w3c-draft"}},[e._v("W3C Draft")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html",target:"_blank"}},[e._v("文档地址")])])]),e._v(" "),n("p",[e._v("题目叫 “Efficient Script Yielding”，一份 2011 年的 “Editor's Draft”，从题目就能看出用途。建议有时间读一遍，超级短。摘要就一句话：")]),e._v(" "),n("blockquote",[n("p",[e._v("This specification defines an interface for web applications to flush the browser event queue and receive an immediate callback.\n本说明文档定义了一个用于刷新浏览器事件队列、接收即时回调的 Web 应用接口。")])]),e._v(" "),n("h2",{attrs:{id:"mdn"}},[e._v("MDN")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/setImmediate",target:"_blank"}},[e._v("文档地址")])])]),e._v(" "),n("p",[e._v("MDN 的文档没得说。遇到问题去查查肯定不会害你，有时候运气好，还能读到翻译过来的中文版：")]),e._v(" "),n("blockquote",[n("p",[e._v("This method is used to break up long running operations and run a callback function immediately after the browser has completed other operations such as events and display updates.\n该方法用来把一些需要长时间运行的操作放在一个回调函数里,在浏览器完成后面的其他语句后,就立刻执行这个回调函数。")])]),e._v(" "),n("p",[e._v("但同时，文档提到， "),n("strong",[e._v("只有 IE 10+ 和 Node.js 0.10+ 实现了该方法")]),e._v("。setImmediate 受到了 Gecko 和 Webkit 的 “resistance”（抵制）。建议跟着去看看热闹。")]),e._v(" "),n("p",[e._v("MDN 文档中提到了三种模拟 setImmediate 的方式："),n("code",[e._v("postMessage")]),e._v("、"),n("code",[e._v("MessageChannel")]),e._v("、"),n("code",[e._v("setTimeout(fn, 0)")]),e._v("。")]),e._v(" "),n("h2",{attrs:{id:"setimmediate-polyfill"}},[e._v("setImmediate polyfill")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/YuzuJS/setImmediate",target:"_blank"}},[e._v("源码")])])]),e._v(" "),n("p",[e._v("对于 Node 0.9 之前的，使用 "),n("code",[e._v("process.nextTick")]),e._v(" 模拟；对于非 IE 10 的现代浏览器，使用 "),n("code",[e._v("postMessage")]),e._v("；对 Web Worker，使用 "),n("code",[e._v("MessageChannel")]),e._v("（这个之后需要关注下）；对 IE 6–8，向 html 中插入新的 script 标签，在 "),n("code",[e._v("onreadystatechange")]),e._v(" 事件中执行回调；其他浏览器，统一使用 "),n("code",[e._v("setTimeout(fn, 0)")]),e._v(" 的形式。")]),e._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[n("span",{staticClass:"hljs-comment"},[e._v("// Don't get fooled by e.g. browserify environments.")]),e._v("\n"),n("span",{staticClass:"hljs-keyword"},[e._v("if")]),e._v(" ({}.toString.call(global.process) === "),n("span",{staticClass:"hljs-string"},[e._v('"[object process]"')]),e._v(") {\n    "),n("span",{staticClass:"hljs-comment"},[e._v("// For Node.js before 0.9")]),e._v("\n    installNextTickImplementation();\n\n} "),n("span",{staticClass:"hljs-keyword"},[e._v("else")]),e._v(" "),n("span",{staticClass:"hljs-keyword"},[e._v("if")]),e._v(" (canUsePostMessage()) {\n    "),n("span",{staticClass:"hljs-comment"},[e._v("// For non-IE10 modern browsers")]),e._v("\n    installPostMessageImplementation();\n\n} "),n("span",{staticClass:"hljs-keyword"},[e._v("else")]),e._v(" "),n("span",{staticClass:"hljs-keyword"},[e._v("if")]),e._v(" (global.MessageChannel) {\n    "),n("span",{staticClass:"hljs-comment"},[e._v("// For web workers, where supported")]),e._v("\n    installMessageChannelImplementation();\n\n} "),n("span",{staticClass:"hljs-keyword"},[e._v("else")]),e._v(" "),n("span",{staticClass:"hljs-keyword"},[e._v("if")]),e._v(" (doc && "),n("span",{staticClass:"hljs-string"},[e._v('"onreadystatechange"')]),e._v(" "),n("span",{staticClass:"hljs-keyword"},[e._v("in")]),e._v(" doc.createElement("),n("span",{staticClass:"hljs-string"},[e._v('"script"')]),e._v(")) {\n    "),n("span",{staticClass:"hljs-comment"},[e._v("// For IE 6–8")]),e._v("\n    installReadyStateChangeImplementation();\n\n} "),n("span",{staticClass:"hljs-keyword"},[e._v("else")]),e._v(" {\n    "),n("span",{staticClass:"hljs-comment"},[e._v("// For older browsers")]),e._v("\n    installSetTimeoutImplementation();\n}")])]),n("h2",{attrs:{id:"nicholas-c-zakas-"}},[e._v("Nicholas C. Zakas 的文章")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.nczonline.net/blog/2011/09/19/script-yielding-with-setimmediate/",target:"_blank"}},[e._v("文章地址")])])]),e._v(" "),n("p",[e._v("文章很短，但讲得还挺仔细的。作者提到了两点好处：")]),e._v(" "),n("ul",[n("li",[e._v("可以直接在 UI 队列清空后直接插入 JS 任务；")]),e._v(" "),n("li",[e._v("延迟更短，不必等待下一次 timer tick")])]),e._v(" "),n("h2",{attrs:{id:"edge-demo"}},[e._v("Edge Demo")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://msedgeportal.trafficmanager.net/en-us/microsoft-edge/testdrive/demos/setImmediateSorting/",target:"_blank"}},[e._v("Demo 地址")])])]),e._v(" "),n("p",[e._v("通过 250 个数的排序，来对比处理效率。基本原理是，排序时将每一步的交换操作放在回调中，对比排序完成的效率。一共有四种：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("setTimeout(fn, 15)")])]),e._v(" "),n("li",[n("code",[e._v("setTimeout(fn, 4)")])]),e._v(" "),n("li",[n("code",[e._v("PostMessage")])]),e._v(" "),n("li",[n("code",[e._v("setImmediate")])])]),e._v(" "),n("p",[e._v("关于前两种的时间间隔问题，建议直接取读 demo 底部的说明。已经很详细了。")]),e._v(" "),n("h2",{attrs:{id:"stackoverflow"}},[e._v("Stackoverflow")]),e._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{href:"http://stackoverflow.com/questions/15349733/setimmediate-vs-nexttick",target:"_blank"}},[e._v("setImmediate vs. nextTick")])])]),e._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://stackoverflow.com/questions/17502948/nexttick-vs-setimmediate-visual-explanation",target:"_blank"}},[e._v("nextTick vs setImmediate, visual explanation")])])])]),e._v(" "),n("h2",{attrs:{id:"-"}},[e._v("题外话")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("以前竟然不知道 setTimeout 也能接收第三个第四个参数的。"),n("code",[e._v("setTimeout((a, b) => a + b, 0, 22, 33)")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("!(x > 9)")]),e._v(" 和 "),n("code",[e._v("x <= 9")]),e._v(" 可不一定完全等价，前者在不确定 "),n("code",[e._v("x")]),e._v(" 的类型时，特别有用，不用额外判断 undefined。")])])])])},[],!1,null,null,null);t.default=component.exports}}]);