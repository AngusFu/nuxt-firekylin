(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{182:function(t,v,n){"use strict";n.r(v);var _={computed:{data:function(){return{title:"[译] 让人倾倒的 11 个 npm trick",keywords:"翻译,Node.js,npm",pathname:"eleven-npm-tricks-that-will-knock-your-wombat-socks-off",translation:{author:"@Tierney Coren",social:"https://twitter.com/bitandbang",from:"https://nodesource.com/blog/eleven-npm-tricks-that-will-knock-your-wombat-socks-off/"},create_time:"2016-09-03",prev:{title:"笔记：TypeScript 中引用全局变量",pathname:"ts-note-on-global-reference"},next:{title:"[译] HTTP 推送",pathname:"being-pushy"}}}}},e=n(3),component=Object(e.a)(_,function(){var t=this,v=t.$createElement,n=t._self._c||v;return n("post",{attrs:{data:t.data}},[n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t014d6a103b20214141.png",expression:"`https://p.ssl.qhimg.com/t014d6a103b20214141.png`"}],attrs:{alt:"让人倾倒的 11 个 npm trick"}})]),t._v(" "),n("p",[t._v("有效率地使用 npm 可能会很困难。内置特性堆积如山，尝试学习它们是很艰巨的任务。")]),t._v(" "),n("p",[t._v("就我个人而言，单学习并使用其中一些小 trick 解救了我，从前移除那些未使用的模块时，我只能先删除整个 "),n("code",[t._v("node_modules")]),t._v(" 文件夹，接着再用 "),n("code",[t._v("npm install")]),t._v(" 重新安装"),n("em",[t._v("一切")]),t._v("。（"),n("code",[t._v("npm prune")]),t._v("，请见本文第四节。）如你所想，这简直要让人发狂了。")]),t._v(" "),n("p",[t._v("我们编了这样一个 trick 列表，使用起来很简单，它们会加速你使用 npm 开发的过程，无论你在做什么项目。")]),t._v(" "),n("h2",{attrs:{id:"1-package-"}},[t._v("1.打开 package 主页")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm home $package")])]),t._v(" "),n("p",[t._v("执行 "),n("code",[t._v("home")]),t._v(" 命令会打开 "),n("code",[t._v("$package")]),t._v(" 的主页。例如，如果指定 "),n("code",[t._v("$package")]),t._v(" 为 "),n("code",[t._v("lodash")]),t._v("，那么就就会打开 Lodash 官网。没有安装（全局/某个项目） package 不影响该命令的使用。")]),t._v(" "),n("h2",{attrs:{id:"2-package-github-"}},[t._v("2. 打开 package Github 仓库")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm repo $package")])]),t._v(" "),n("p",[t._v("类似前面的 "),n("code",[t._v("home")]),t._v(" 命令， "),n("code",[t._v("repo")]),t._v("  命令会打开 "),n("code",[t._v("$package")]),t._v(" 的 Github 仓库。如 "),n("code",[t._v("npm repo express")]),t._v(" 会打开 Express 的官方仓库地址。同样，不需要安装 package 就能使用。")]),t._v(" "),n("h2",{attrs:{id:"3-package-"}},[t._v("3. 检查 package 的过时依赖")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm outdated")])]),t._v(" "),n("p",[t._v("在项目中，运行 "),n("code",[t._v("outdated")]),t._v(" 命令会通过 npm registry 检查是否有过时的 package，并在命令行中打印出当前版本、所需版本以及最新版本。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t01be55669dcc86377b.png",expression:"`https://p.ssl.qhimg.com/t01be55669dcc86377b.png`"}],attrs:{alt:"在 Node 项目中运行 npm outdated"}})]),t._v(" "),n("h2",{attrs:{id:"4-package-json-package"}},[t._v("4. 检查 package.json 中未声明的 package")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm prune")])]),t._v(" "),n("p",[t._v("运行 "),n("code",[t._v("prune")]),t._v(" 命令，npm CLI 会读取 "),n("code",[t._v("package.json")]),t._v("，并将结果与项目的 "),n("code",[t._v("/node_modules")]),t._v(" 目录进行对比，并打印出不在  "),n("code",[t._v("package.json")]),t._v(" 之列的模块列表。")]),t._v(" "),n("p",[n("code",[t._v("npm prune")]),t._v(" 命令接着会拿出这些 package，并移除那些没有手动加到 "),n("code",[t._v("package.json")]),t._v(" 中或没有使用 "),n("code",[t._v("--save")]),t._v(" 标志安装的 package。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t01d021722c08048520.png",expression:"`https://p.ssl.qhimg.com/t01d021722c08048520.png`"}],attrs:{alt:"在 Node 项目中运行 npm prune"}})]),t._v(" "),n("p",[n("strong",[t._v("更新：")]),t._v(" 感谢 "),n("a",{attrs:{href:"https://twitter.com/EvanHahn",target:"_blank"}},[t._v("@EvanHahn")]),t._v(" 提醒，一种个人配置可以让 "),n("code",[t._v("npm prune")]),t._v(" 提供与 "),n("code",[t._v("npm")]),t._v(" 默认方式略有不同的结果。")]),t._v(" "),n("h2",{attrs:{id:"5-"}},[t._v("5. 锁定依赖版本")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm shrinkwrap")])]),t._v(" "),n("p",[t._v("在项目中使用 "),n("code",[t._v("shrinkwrap")]),t._v(" 命令，会生成一个 "),n("code",[t._v("npm-shrinkwrap.json")]),t._v(" 文件，将项目依赖锁定在当前在 "),n("code",[t._v("node_modules")]),t._v(" 中使用的特定版本。运行 "),n("code",[t._v("npm install")]),t._v(" 时，若发现存在 "),n("code",[t._v("npm-shrinkwrap.json")]),t._v("，则会覆盖列出的依赖以及 "),n("code",[t._v("package.json")]),t._v(" 中的任何语义版本范围。")]),t._v(" "),n("p",[t._v("如果需要验证项目中 "),n("code",[t._v("package.json")]),t._v("、 "),n("code",[t._v("npm-shrinkwrap.json")]),t._v(" 及 "),n("code",[t._v("node_modules")]),t._v(" 的一致性，可以考虑使用 "),n("a",{attrs:{href:"https://github.com/uber/npm-shrinkwrap",target:"_blank"}},[t._v("npm-shrinkwrap")]),t._v("。")]),t._v(" "),n("p",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"https://p.ssl.qhimg.com/t010ecff8dd4bc1fe35.png",expression:"`https://p.ssl.qhimg.com/t010ecff8dd4bc1fe35.png`"}],attrs:{alt:"在 Node 项目中运行 npm shrinkwrap"}})]),t._v(" "),n("h2",{attrs:{id:"6-node-js-v4-lts-npm-v3"}},[t._v("6. 在 Node.js v4 LTS 中使用 npm v3")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm install -g npm@3")])]),t._v(" "),n("p",[t._v("使用 npm 全局安装 "),n("code",[t._v("npm@3")]),t._v("，会将 npm v2 升级至 v3。使用 npm v2 LTS 的 Node.js v4 LTS 发布版本（“Argon”）中也是如此。这会在 v4 LTS 中安装 npm v3 的最新稳定版本。（译者注：LTS 指 Long-Term Support， 即提供长期技术支持的版本。）")]),t._v(" "),n("h2",{attrs:{id:"7-npm-install-g-sudo-"}},[t._v("7. 运行 "),n("code",[t._v("npm install -g")]),t._v("，无需加  "),n("code",[t._v("sudo")])]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm config set prefix $dir")])]),t._v(" "),n("p",[n("code",[t._v("$dir")]),t._v(" 指你想将"),n("em",[t._v("全局依赖安装在的")]),t._v("目录，运行命令，这一来，安装全局模块再也不用使用 sudo，该目录则成为全局的 bin 目录。唯一需要注意的是，确保使用 "),n("code",[t._v("chown -R $USER $dir")]),t._v(" 该目录的"),n("strong",[t._v("调整用户权限")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"8-"}},[t._v("8. 改变所有项目的默认前缀")]),t._v(" "),n("p",[n("strong",[t._v("运行:")]),t._v(" "),n("code",[t._v("npm config set save-prefix ~")])]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("--save")]),t._v(" 或 "),n("code",[t._v("--save-dev")]),t._v(" 标志安装新 package 时，使用 "),n("code",[t._v("~")]),t._v(" 比默认的 "),n("code",[t._v("^")]),t._v(" 行为更加保守。"),n("code",[t._v("~")]),t._v(" 将依赖锁定在小版本（minor version），允许使用 "),n("code",[t._v("npm update")]),t._v(" 安装补丁版本。"),n("code",[t._v("^")]),t._v(" 将依赖锁定在主版本，允许使用 "),n("code",[t._v("npm update")]),t._v("更新小版本。")]),t._v(" "),n("h2",{attrs:{id:"9-devdependencies-"}},[t._v("9. 生产环境下去除 "),n("code",[t._v("devDependencies")]),t._v(" 依赖")]),t._v(" "),n("p",[t._v("项目准备上到生产环境时，确保使用 "),n("code",[t._v("--production")]),t._v(" 标志安装依赖。该标志会安装 "),n("code",[t._v("dependencies")]),t._v("，忽略 "),n("code",[t._v("devDependencies")]),t._v("。这会确保开发所使用的工具及 package 不会进入生产环境。")]),t._v(" "),n("p",[t._v("此外，还可以将 "),n("code",[t._v("NODE_ENV")]),t._v(" 环境变量设置为 "),n("code",[t._v("production")]),t._v("，确保 "),n("code",[t._v("devDependencies")]),t._v(" 绝不会被安装。")]),t._v(" "),n("h2",{attrs:{id:"10-npmignore-"}},[t._v("10. 使用 "),n("code",[t._v(".npmignore")]),t._v(" 要当心")]),t._v(" "),n("p",[t._v("如果还没使用过 "),n("code",[t._v(".npmignore")]),t._v("，会默认使用 "),n("code",[t._v(".gitignore")]),t._v(" 文件，加上一些更健全的默认选项。")]),t._v(" "),n("p",[t._v("很多人不明白都是，一旦在项目中添加了 "),n("code",[t._v(".npmignore")]),t._v(" 文件，"),n("code",[t._v(".gitignore")]),t._v(" 的规则就会被忽略（好讽刺，出乎意料啊）。结果就是，发布项目时，不得不审查两个文件是否同步，防止敏感信息的泄露。")]),t._v(" "),n("h2",{attrs:{id:"11-npm-init-"}},[t._v("11. 带默认内容的 "),n("code",[t._v("npm init")])]),t._v(" "),n("p",[t._v("在新项目中运行 "),n("code",[t._v("npm init")]),t._v(" 时，可以配置 "),n("code",[t._v("package.json")]),t._v(" 细节。如果想设置 "),n("code",[t._v("npm init")]),t._v(" 会一直使用的默认工作，可以使用 "),n("code",[t._v("config set")]),t._v(" 命令，加上一些额外的参数：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-bash"},[t._v("npm config "),n("span",{staticClass:"hljs-built_in"},[t._v("set")]),t._v(" init.author.name "),n("span",{staticClass:"hljs-variable"},[t._v("$name")]),t._v("\nnpm config "),n("span",{staticClass:"hljs-built_in"},[t._v("set")]),t._v(" init.author.email "),n("span",{staticClass:"hljs-variable"},[t._v("$email")])])]),n("p",[t._v("若想彻底自定义初始化脚本，可以指定一个自定义的默认脚本：")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-bash"},[t._v("npm config "),n("span",{staticClass:"hljs-built_in"},[t._v("set")]),t._v(" init-module ~/.npm-init.js")])]),n("p",[t._v("下面是一个示例脚本，会弹出私有设置项，在需要情况下创建 Github 仓库。确保更改默认的 Github 用户名（"),n("code",[t._v("YOUR_GITHUB_USERNAME")]),t._v("），作为 Github 用户名环境变量的 fallback 值。")]),t._v(" "),n("pre",[n("code",{staticClass:"hljs lang-javascript"},[n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" cp = "),n("span",{staticClass:"hljs-built_in"},[t._v("require")]),t._v("("),n("span",{staticClass:"hljs-string"},[t._v("'child_process'")]),t._v(");\n"),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" priv;\n\n"),n("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" USER = process.env.GITHUB_USERNAME || "),n("span",{staticClass:"hljs-string"},[t._v("'YOUR_GITHUB_USERNAME'")]),t._v(";\n\n"),n("span",{staticClass:"hljs-built_in"},[t._v("module")]),t._v(".exports = {\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("name")]),t._v(": prompt("),n("span",{staticClass:"hljs-string"},[t._v("'name'")]),t._v(", basename || package.name),\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("version")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v("'0.0.1'")]),t._v(",\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("private")]),t._v(": prompt("),n("span",{staticClass:"hljs-string"},[t._v("'private'")]),t._v(", "),n("span",{staticClass:"hljs-string"},[t._v("'true'")]),t._v(", "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("val")]),t._v(")")]),t._v("{\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" priv = ("),n("span",{staticClass:"hljs-keyword"},[t._v("typeof")]),t._v(" val === "),n("span",{staticClass:"hljs-string"},[t._v("'boolean'")]),t._v(") ? val : !!val.match("),n("span",{staticClass:"hljs-string"},[t._v("'true'")]),t._v(")\n  }),\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("create")]),t._v(": prompt("),n("span",{staticClass:"hljs-string"},[t._v("'create github repo'")]),t._v(", "),n("span",{staticClass:"hljs-string"},[t._v("'yes'")]),t._v(", "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("val")]),t._v(")")]),t._v("{\n    val = val.indexOf("),n("span",{staticClass:"hljs-string"},[t._v("'y'")]),t._v(") !== "),n("span",{staticClass:"hljs-number"},[t._v("-1")]),t._v(" ? "),n("span",{staticClass:"hljs-literal"},[t._v("true")]),t._v(" : "),n("span",{staticClass:"hljs-literal"},[t._v("false")]),t._v(";\n\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v("(val){\n      "),n("span",{staticClass:"hljs-built_in"},[t._v("console")]),t._v(".log("),n("span",{staticClass:"hljs-string"},[t._v("'enter github password:'")]),t._v(");\n      cp.execSync("),n("span",{staticClass:"hljs-string"},[t._v('"curl -u \'"')]),t._v("+USER+"),n("span",{staticClass:"hljs-string"},[t._v('"\' https://api.github.com/user/repos -d "')]),t._v(" +\n        "),n("span",{staticClass:"hljs-string"},[t._v('"\'{\\"name\\": \\""')]),t._v("+basename+"),n("span",{staticClass:"hljs-string"},[t._v('"\\", \\"private\\": "')]),t._v("+ ((priv) ? "),n("span",{staticClass:"hljs-string"},[t._v("'true'")]),t._v(" : "),n("span",{staticClass:"hljs-string"},[t._v("'false'")]),t._v(")  +"),n("span",{staticClass:"hljs-string"},[t._v('"}\' "')]),t._v(");\n      cp.execSync("),n("span",{staticClass:"hljs-string"},[t._v("'git remote add origin '")]),t._v("+ "),n("span",{staticClass:"hljs-string"},[t._v("'https://github.com/'")]),t._v("+USER+"),n("span",{staticClass:"hljs-string"},[t._v("'/'")]),t._v(" + basename + "),n("span",{staticClass:"hljs-string"},[t._v("'.git'")]),t._v(");\n    }\n\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" "),n("span",{staticClass:"hljs-literal"},[t._v("undefined")]),t._v(";\n  }),\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("main")]),t._v(": prompt("),n("span",{staticClass:"hljs-string"},[t._v("'entry point'")]),t._v(", "),n("span",{staticClass:"hljs-string"},[t._v("'index.js'")]),t._v("),\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("repository")]),t._v(": {\n    "),n("span",{staticClass:"hljs-attr"},[t._v("type")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v("'git'")]),t._v(",\n    "),n("span",{staticClass:"hljs-attr"},[t._v("url")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v("'git://github.com/'")]),t._v("+USER+"),n("span",{staticClass:"hljs-string"},[t._v("'/'")]),t._v(" + basename + "),n("span",{staticClass:"hljs-string"},[t._v("'.git'")]),t._v(" },\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("bugs")]),t._v(": { "),n("span",{staticClass:"hljs-attr"},[t._v("url")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v("'https://github.com/'")]),t._v("+USER"),n("span",{staticClass:"hljs-string"},[t._v("'/'")]),t._v(" + basename + "),n("span",{staticClass:"hljs-string"},[t._v("'/issues'")]),t._v(" },\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("homepage")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v('"https://github.com/"')]),t._v("+USER+"),n("span",{staticClass:"hljs-string"},[t._v('"/"')]),t._v(" + basename,\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("keywords")]),t._v(": prompt("),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),n("span",{staticClass:"hljs-params"},[t._v("s")]),t._v(") ")]),t._v("{ "),n("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" s.split("),n("span",{staticClass:"hljs-regexp"},[t._v("/\\s+/")]),t._v(") }),\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("license")]),t._v(": "),n("span",{staticClass:"hljs-string"},[t._v("'MIT'")]),t._v(",\n\n  "),n("span",{staticClass:"hljs-attr"},[t._v("cleanup")]),t._v(": "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("cb")]),t._v(")")]),t._v("{\n\n    cb("),n("span",{staticClass:"hljs-literal"},[t._v("null")]),t._v(", "),n("span",{staticClass:"hljs-literal"},[t._v("undefined")]),t._v(")\n  }\n\n}")])]),n("h2",{attrs:{id:"-"}},[t._v("最后一点...")]),t._v(" "),n("p",[t._v("若想学习更多关于 npm、Node.js、JavaScript、Docker、Kubernetes 以及 Electron 等等等等，可以在 Twitter、 上关注 "),n("a",{attrs:{href:"https://twitter.com/nodesource",target:"_blank"}},[t._v("@NodeSource")]),t._v("。我们一直都在，很乐意收到你的消息！")])])},[],!1,null,null,null);v.default=component.exports}}]);