(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{251:function(t,n,l){"use strict";l.r(n);var e={computed:{data:function(){return{title:"判断资源并行加载完成的三种办法：计数、Promise及 $.Deferred",description:"判断资源并行加载完成的三种办法：计数、Promise及 $.Deferred",keywords:"原创,开发心得,JavaScript,Promise",pathname:"when-are-all-resources-all-loaded",translation:null,create_time:"2016-07-04",prev:{title:"[译] 测试驱动开发：使用 Node.js 和 MongoDB 构建 Todo API",pathname:"todo-api-with-unit-test"},next:{title:"使用 ava 和 jsdom 测试前端界面",pathname:"test-with-ava-jsdom"}}}}},r=l(3),component=Object(r.a)(e,function(){var t=this,n=t.$createElement,l=t._self._c||n;return l("post",{attrs:{data:t.data}},[l("h2",{attrs:{id:"-"}},[t._v("方法一：计数比较")]),t._v(" "),l("pre",[l("code",{staticClass:"hljs lang-javascript"},[l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" "),l("span",{staticClass:"hljs-title"},[t._v("loadImg")]),t._v("("),l("span",{staticClass:"hljs-params"},[t._v("url, cb")]),t._v(") ")]),t._v("{\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" img = "),l("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Image();\n    img.src = url;\n    img.onload = cb;\n}\n\n"),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" "),l("span",{staticClass:"hljs-title"},[t._v("loadImages")]),t._v("("),l("span",{staticClass:"hljs-params"},[t._v("urlArr, afterAllLoadedFunc")]),t._v(") ")]),t._v("{\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" count = urlArr.length;\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" loadedCount = "),l("span",{staticClass:"hljs-number"},[t._v("0")]),t._v(";\n\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("for")]),t._v(" ("),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" i = count - "),l("span",{staticClass:"hljs-number"},[t._v("1")]),t._v("; i >= "),l("span",{staticClass:"hljs-number"},[t._v("0")]),t._v("; i--) {\n        loadImg(urlArr[i], "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n            loadedCount += "),l("span",{staticClass:"hljs-number"},[t._v("1")]),t._v(";\n            "),l("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (count === loadedCount) {\n                afterAllLoadedFunc();\n            }\n        });\n    }\n}\n\nloadImages(["),l("span",{staticClass:"hljs-string"},[t._v("'./xx.jpg'")]),t._v(", "),l("span",{staticClass:"hljs-string"},[t._v("'./yy.jpg'")]),t._v(", "),l("span",{staticClass:"hljs-string"},[t._v("'./zz.jpg'")]),t._v("], "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n    alert("),l("span",{staticClass:"hljs-string"},[t._v("'all imgs have been loaded'")]),t._v(");\n});")])]),l("h2",{attrs:{id:"-promise"}},[t._v("方法二：Promise")]),t._v(" "),l("pre",[l("code",{staticClass:"hljs lang-javascript"},[l("span",{staticClass:"hljs-comment"},[t._v("// 使用 Promise")]),t._v("\n"),l("span",{staticClass:"hljs-comment"},[t._v("// 兼容的话需要引入 es6-promise 库")]),t._v("\n\n"),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" loadImg = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"},[t._v("url")]),t._v(") ")]),t._v("{\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" "),l("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" "),l("span",{staticClass:"hljs-built_in"},[t._v("Promise")]),t._v("("),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"},[t._v("resolve, reject")]),t._v(") ")]),t._v("{\n        "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" img = "),l("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Image();\n        img.src = url;\n        img.onload = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n            resolve()  ;\n        };\n        img.onerror = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n            reject()  ;\n        };\n    });\n};\n\n"),l("span",{staticClass:"hljs-built_in"},[t._v("Promise")]),t._v(".all([\n    loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'xxx.jpg'")]),t._v("),\n    loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'yyy.jpg'")]),t._v("),\n    loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'zzz.jpg'")]),t._v("),\n]).then("),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n    alert("),l("span",{staticClass:"hljs-string"},[t._v("'all images are loaded!'")]),t._v(")\n});")])]),l("h2",{attrs:{id:"-deferred"}},[t._v("方法三：$.Deferred")]),t._v(" "),l("pre",[l("code",{staticClass:"hljs lang-javascript"},[l("span",{staticClass:"hljs-comment"},[t._v("// 如果有jquery")]),t._v("\n"),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" loadImg = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"},[t._v("url")]),t._v(") ")]),t._v("{\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" defer = $.Deferred();\n\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("var")]),t._v(" img = "),l("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Image();\n    img.src = url;\n    img.onload = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n        defer.resolve()  ;\n    };\n    img.onerror = "),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n        defer.reject()  ;\n    };\n\n    "),l("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" defer.promise();\n};\n\n$.when(loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'xx.jpg'")]),t._v("), loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'yy.jpg'")]),t._v("), loadImg("),l("span",{staticClass:"hljs-string"},[t._v("'zz.jpg'")]),t._v(")).done("),l("span",{staticClass:"hljs-function"},[l("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" ("),l("span",{staticClass:"hljs-params"}),t._v(") ")]),t._v("{\n    alert("),l("span",{staticClass:"hljs-string"},[t._v("'all images are loaded!'")]),t._v(")\n});")])]),l("p",[t._v("更多请参考 "),l("a",{attrs:{href:"http://angusfu.github.io/slides/promise/",target:"_blank"}},[t._v("http://angusfu.github.io/slides/promise/")])])])},[],!1,null,null,null);n.default=component.exports}}]);